@model Anket

<div class="container mt-5">
    <div class="card">
        <div class="card-body">
            <h2 class="card-title">@Model.Baslik</h2>

            <form id="surveyForm">
                <input type="hidden" name="surveyId" value="@Model.Id">
                @foreach (var question in Model.Sorular)
                {
                    <div class="form-group">
                        <label>@question.Metin</label>
                        <input type="text" class="form-control" name="Cevaplar" required>
                        <input type="hidden" name="SoruIds" value="@question.Id">
                    </div>
                }
                <button type="submit" class="btn btn-primary">Cevapları Gönder</button>
            </form>
        </div>
    </div>
</div>

@section scripts
{
    <script>
        document.getElementById('surveyForm').onsubmit = async function (e) {
            e.preventDefault();

            var formData = new FormData(this);

            try {
                const response = await fetch('@Url.Action("SubmitAnswers", "Home", new { area = "Anket" })', {
    method: 'POST',
    body: formData
});


                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                const data = await response.json();

                console.log(data);

                if (data.redirectUrl) {
                    window.location.href = data.redirectUrl;
                } else {
                    console.log(data);
                }
            } catch (error) {
                console.error('There was a problem with the fetch operation:', error);
            }
        };
    </script>
}
